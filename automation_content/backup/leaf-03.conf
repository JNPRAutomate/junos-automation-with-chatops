## Last changed: 2016-10-27 09:25:54 CEST
version 14.1X53-D38;
system {
    host-name leaf-03;
    time-zone Europe/Amsterdam;
    root-authentication {
        encrypted-password "$1$wn55LLbk$SJsBNNKCq8U1z3OfQOwFh0";
    }
    name-server {
        172.30.207.10;
    }
    login {
        message "Welcome to EMEA SLAB ";
        user lab {
            uid 2000;
            class super-user;
            authentication {
                encrypted-password "$1$HT73bmKu$e.7tBoJ5HLlv9OtkaYwu40";
            }
        }
    }
    services {
        ssh;
        netconf {
            ssh;
        }
    }
    syslog {
        user * {
            any emergency;
        }
        file messages {
            any notice;
        }
        file cli-commands {
            interactive-commands any;
            explicit-priority;
        }
        time-format millisecond;
    }
    ntp {
        server 172.30.207.10;
    }
}
chassis {
    aggregated-devices {
        ethernet {
            device-count 2;
        }
    }
}
/* This block of configuration has been generated by the role underlay-ebgp for Ansible */
interfaces {
    xe-0/0/0 {
        description " * to spine-03";
        mtu 9192;
        unit 0 {
            family inet {
                mtu 9000;
                address 172.16.0.25/31;
            }
        }
    }
    xe-0/0/1 {
        description " * to spine-04";
        mtu 9192;
        unit 0 {
            family inet {
                mtu 9000;
                address 172.16.0.29/31;
            }
        }
    }
    xe-0/0/12 {
        description "to access";
        unit 0 {
            family ethernet-switching {
                interface-mode access;
                vlan {
                    members 105;
                }
            }
        }
    }
    xe-0/0/13 {
        description "to access";
        unit 0 {
            family ethernet-switching {
                interface-mode trunk;
                vlan {
                    members 100-108;
                }
            }
        }
    }
    xe-0/0/47 {
        description "to access";
        ether-options {
            802.3ad ae0;
        }
    }
    ae0 {
        description "to customer XX - server YY";
        esi {
            00:01:01:01:01:01:01:01:01:01;
            all-active;
        }
        aggregated-ether-options {
            lacp {
                active;
                system-id 00:00:00:01:01:01;
            }
        }
        unit 0 {
            family ethernet-switching {
                interface-mode trunk;
                vlan {
                    members 100-108;
                }
            }
        }
    }
    lo0 {
        unit 0 {
            family inet {
                address 100.0.0.23/32;
            }
        }
    }
    vme {
        unit 0 {
            family inet {
                address 172.30.52.63/24;
            }
        }
    }
}
snmp {
    location "Site 1";
    contact "John Doe";
    community public {
        authorization read-only;
    }
}
routing-options {
    static {
        route 172.16.0.0/12 {
            next-hop 172.30.52.1;
            retain;
            no-readvertise;
        }
    }
    router-id 100.0.0.23;
    forwarding-table {
        export pfe-ecmp;
    }
}
/* This block of configuration has been generated by the role overlay-evpn-qfx-l2 for Ansible */
protocols {
    bgp {
        log-updown;
        graceful-restart;
        group overlay-evpn {
            type internal;
            local-address 100.0.0.23;
            import OVERLAY-IN;
            family evpn {
                signaling;
            }
            local-as 65200;
            bfd-liveness-detection {
                minimum-interval 350;
                multiplier 3;
                session-mode automatic;
            }
            multipath;
            neighbor 100.0.0.13;
            neighbor 100.0.0.14;
        }
        group underlay-ipfabric {
            type external;
            mtu-discovery;
            import bgp-ipclos-in;
            export bgp-ipclos-out;
            local-as 65023;
            bfd-liveness-detection {
                minimum-interval 350;
                multiplier 3;
                session-mode automatic;
            }
            multipath multiple-as;
            neighbor 172.16.0.28 {
                peer-as 65014;
            }
            neighbor 172.16.0.24 {
                peer-as 65013;
            }
        }
    }
    evpn {
        vni-options {
            vni 9100 {
                vrf-target export target:1:9100;
            }
            vni 9101 {
                vrf-target export target:1:9101;
            }
            vni 9102 {
                vrf-target export target:1:9102;
            }
            vni 9103 {
                vrf-target export target:1:9103;
            }
            vni 9104 {
                vrf-target export target:1:9104;
            }
            vni 9105 {
                vrf-target export target:1:9105;
            }
            vni 9106 {
                vrf-target export target:1:9106;
            }
            vni 9107 {
                vrf-target export target:1:9107;
            }
            vni 9108 {
                vrf-target export target:1:9108;
            }
            vni 9109 {
                vrf-target export target:1:9109;
            }
        }
        encapsulation vxlan;
        extended-vni-list [ 9100 9101 9102 9103 9104 9105 9106 9107 9108 9109 ];
        multicast-mode ingress-replication;
    }
    lldp {
        interface all;
    }
}
policy-options {
    policy-statement LEAF-IN {
        term import_leaf_esi {
            from community comm-leaf_esi;
            then accept;
        }
        term import_vni9105 {
            from community com9105;
            then accept;
        }
        term import_vni9106 {
            from community com9106;
            then accept;
        }
        term import_vni9107 {
            from community com9107;
            then accept;
        }
        term import_vni9108 {
            from community com9108;
            then accept;
        }
        term import_vni9109 {
            from community com9109;
            then accept;
        }
        term import_vni9100 {
            from community com9100;
            then accept;
        }
        term import_vni9101 {
            from community com9101;
            then accept;
        }
        term import_vni9102 {
            from community com9102;
            then accept;
        }
        term import_vni9103 {
            from community com9103;
            then accept;
        }
        term import_vni9104 {
            from community com9104;
            then accept;
        }
        term ks {
            from community target:11:10;
            then accept;
        }
        term default {
            then reject;
        }
    }
    policy-statement OVERLAY-IN {
        term reject-remote-gw {
            from {
                family evpn;
                next-hop [ 100.0.0.11 100.0.0.12 ];
                nlri-route-type [ 1 2 ];
            }
            then reject;
        }
        term accept-all {
            then accept;
        }
    }
    policy-statement bgp-ipclos-in {
        term loopbacks {
            from {
                route-filter 100.0.0.0/16 orlonger;
            }
            then accept;
        }
    }
    policy-statement bgp-ipclos-out {
        term loopback {
            from {
                protocol direct;
                route-filter 100.0.0.23/32 orlonger;
            }
            then {
                community add MYCOMMUNITY;
                next-hop self;
                accept;
            }
        }
        term as-path {
            from {
                as-path asPathLength2;
                community MYCOMMUNITY;
            }
            then reject;
        }
        term reject {
            then reject;
        }
    }
    policy-statement pfe-ecmp {
        then {
            load-balance per-packet;
        }
    }
    community MYCOMMUNITY members target:12345:111;
    community com9100 members target:1:9100;
    community com9101 members target:1:9101;
    community com9102 members target:1:9102;
    community com9103 members target:1:9103;
    community com9104 members target:1:9104;
    community com9105 members target:1:9105;
    community com9106 members target:1:9106;
    community com9107 members target:1:9107;
    community com9108 members target:1:9108;
    community com9109 members target:1:9109;
    community comm-leaf_esi members target:9999:9999;
    community target:11:10 members target:11:10;
    as-path asPathLength2 ".{2,}";
}
switch-options {
    vtep-source-interface lo0.0;
    route-distinguisher 100.0.0.23:1;
    vrf-import LEAF-IN;
    vrf-target target:9999:9999;
}
vlans {
    bd9100 {
        vlan-id 100;
        vxlan {
            vni 9100;
            ingress-node-replication;
        }
    }
    bd9101 {
        vlan-id 101;
        vxlan {
            vni 9101;
            ingress-node-replication;
        }
    }
    bd9102 {
        vlan-id 102;
        vxlan {
            vni 9102;
            ingress-node-replication;
        }
    }
    bd9103 {
        vlan-id 103;
        vxlan {
            vni 9103;
            ingress-node-replication;
        }
    }
    bd9104 {
        vlan-id 104;
        vxlan {
            vni 9104;
            ingress-node-replication;
        }
    }
    bd9105 {
        vlan-id 105;
        vxlan {
            vni 9105;
            ingress-node-replication;
        }
    }
    bd9106 {
        vlan-id 106;
        vxlan {
            vni 9106;
            ingress-node-replication;
        }
    }
    bd9107 {
        vlan-id 107;
        vxlan {
            vni 9107;
            ingress-node-replication;
        }
    }
    bd9108 {
        vlan-id 108;
        vxlan {
            vni 9108;
            ingress-node-replication;
        }
    }
    bd9109 {
        vlan-id 109;
        vxlan {
            vni 9109;
            ingress-node-replication;
        }
    }
}